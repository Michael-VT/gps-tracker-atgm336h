<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Tracker ATGM336H - WebSocket</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --background-color: #ecf0f1;
            --text-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            transition: all 0.3s ease;
        }
        
        .horizontal-layout {
            flex-direction: row;
        }
        
        .horizontal-layout .map-container {
            flex: 0 0 80%;
            height: 100%;
        }
        
        .horizontal-layout .info-container {
            flex: 0 0 20%;
            height: 100%;
            overflow-y: auto;
            background: white;
            border-left: 3px solid var(--secondary-color);
        }
        
        .vertical-layout {
            flex-direction: column;
        }
        
        .vertical-layout .map-container {
            flex: 0 0 80%;
            width: 100%;
        }
        
        .vertical-layout .info-container {
            flex: 0 0 20%;
            width: 100%;
            overflow-y: auto;
            background: white;
            border-top: 3px solid var(--secondary-color);
        }
        
        .map-container {
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .info-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--primary-color);
        }
        
        .panel-title {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .status-item {
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
        }
        
        .status-label {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-bottom: 3px;
        }
        
        .status-value {
            font-size: 0.9em;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .coordinates {
            grid-column: 1 / -1;
            background: #e8f4fd !important;
            border: 1px solid var(--primary-color) !important;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #layoutToggleBtn {
            background: var(--secondary-color);
            color: white;
        }
        
        #layoutToggleBtn:hover {
            background: #1a252f;
        }
        
        .signal-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .signal-weak { background: var(--danger-color); }
        .signal-medium { background: var(--warning-color); }
        .signal-strong { background: var(--success-color); }
        
        .satellite-bar {
            height: 15px;
            background: #ecf0f1;
            border-radius: 8px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .satellite-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--success-color));
            transition: width 0.5s ease;
        }
        
        .quality-excellent { color: var(--success-color); }
        .quality-good { color: var(--warning-color); }
        .quality-poor { color: var(--danger-color); }
        .quality-none { color: #95a5a6; }
        
        .nmea-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 200px;
        }
        
        #nmeaData {
            flex: 1;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            line-height: 1.3;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="app-container horizontal-layout" id="appContainer">
        <div class="map-container">
            <div id="map"></div>
            <div class="map-controls">
                <button id="layoutToggleBtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é">
                    <span id="layoutIcon">‚Üî</span> –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
                </button>
            </div>
        </div>
        
        <div class="info-container">
            <div class="panel">
                <div class="panel-title">üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (WebSocket)</div>
                <div class="status-item">
                    <div class="status-label">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
                    <div class="status-value">
                        <span class="signal-indicator" id="connectionIndicator"></span>
                        <span id="connectionStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">üì° –°—Ç–∞—Ç—É—Å GPS</div>
                <div class="status-grid">
                    <div class="status-item coordinates">
                        <div class="status-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</div>
                        <div class="status-value" id="coordinates">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–ö–∞—á–µ—Å—Ç–≤–æ —Ñ–∏–∫—Å–∞—Ü–∏–∏</div>
                        <div class="status-value" id="fixStatus">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–í—Ä–µ–º—è GPS</div>
                        <div class="status-value" id="gpsTime">--:--:--</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                        <div class="status-value" id="speed">0.0 –∫–º/—á</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–í—ã—Å–æ—Ç–∞</div>
                        <div class="status-value" id="altitude">0.0 –º</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–ö—É—Ä—Å</div>
                        <div class="status-value" id="course">0¬∞</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫–∏</div>
                <div class="status-item">
                    <div class="status-label">–í–∏–¥–∏–º—ã–µ —Å–ø—É—Ç–Ω–∏–∫–∏</div>
                    <div class="status-value" id="satellitesCount">0</div>
                    <div class="satellite-bar">
                        <div class="satellite-fill" id="satelliteBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-label">–¢–æ—á–Ω–æ—Å—Ç—å (HDOP)</div>
                    <div class="status-value" id="hdop">0.0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">PPS –∏–º–ø—É–ª—å—Å—ã</div>
                    <div class="status-value">
                        <span id="ppsStatus" class="pulse">‚ö™ –û–ñ–ò–î–ê–ù–ò–ï</span>
                        <br>
                        <small>–°—á–µ—Ç—á–∏–∫: <span id="ppsCount">0</span></small>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                        <div class="status-value" id="messageCount">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–û—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞</div>
                        <div class="status-value" id="errorCount">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–ù–µ–≤–µ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                        <div class="status-value" id="invalidCount">0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                        <div class="status-value" id="uptime">00:00:00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">–°–∫–æ—Ä–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</div>
                        <div class="status-value" id="dataRate">0/—Å</div>
                    </div>
                </div>
            </div>
            
            <div class="panel nmea-container">
                <div class="panel-title">üì® NMEA –¥–∞–Ω–Ω—ã–µ</div>
                <div id="nmeaData"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        class GPSTracker {
            constructor() {
                this.map = null;
                this.marker = null;
                this.accuracyCircle = null;
                this.isConnected = false;
                this.messageCount = 0;
                this.errorCount = 0;
                this.invalidCount = 0;
                this.truncatedCount = 0;
                this.ppsCount = 0;
                this.startTime = Date.now();
                this.lastMessages = [];
                this.isHorizontalLayout = true;
                
                // GPS –¥–∞–Ω–Ω—ã–µ
                this.latitude = null;
                this.longitude = null;
                this.altitude = null;
                this.speed = null;
                this.course = null;
                this.timestamp = null;
                this.num_satellites = 0;
                this.fix_quality = 0;
                this.hdop = 0.0;
                
                this.socket = io();
                this.setupSocketEvents();
                this.initMap();
                this.setupEventListeners();
                this.updateUptime();
                setInterval(() => this.updateUptime(), 1000);
            }

            setupSocketEvents() {
                this.socket.on('connect', () => {
                    console.log("WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω");
                    this.updateConnectionStatus('connected', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ GPS –º–æ–¥—É–ª—é');
                });

                this.socket.on('disconnect', () => {
                    console.log("WebSocket –æ—Ç–∫–ª—é—á–µ–Ω");
                    this.updateConnectionStatus('error', '–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                });

                this.socket.on('gps_data', (data) => {
                    this.processNMEAData(data.nmea);
                });

                this.socket.on('connection_status', (data) => {
                    this.updateConnectionStatus(data.status, data.message);
                });
            }

            setupEventListeners() {
                document.getElementById('layoutToggleBtn').addEventListener('click', () => {
                    this.toggleLayout();
                });
            }

            toggleLayout() {
                const appContainer = document.getElementById('appContainer');
                const layoutIcon = document.getElementById('layoutIcon');
                const layoutToggleBtn = document.getElementById('layoutToggleBtn');
                
                this.isHorizontalLayout = !this.isHorizontalLayout;
                
                if (this.isHorizontalLayout) {
                    appContainer.className = 'app-container horizontal-layout';
                    layoutIcon.textContent = '‚Üî';
                    layoutToggleBtn.innerHTML = '<span id="layoutIcon">‚Üî</span> –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ';
                } else {
                    appContainer.className = 'app-container vertical-layout';
                    layoutIcon.textContent = '‚Üï';
                    layoutToggleBtn.innerHTML = '<span id="layoutIcon">‚Üï</span> –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
                }
                
                setTimeout(() => {
                    this.map.invalidateSize();
                }, 300);
            }

            initMap() {
                this.map = L.map('map').setView([50.0, 10.0], 4);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(this.map);

                L.control.scale().addTo(this.map);
            }

            processNMEAData(line) {
                this.messageCount++;
                this.lastMessages.push(line);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                if (this.lastMessages.length > 200) {
                    this.lastMessages.shift();
                }
                
                this.displayNMEALine(line);
                this.parseNMEALine(line);
                this.updateDisplay();
            }

            parseNMEALine(line) {
                try {
                    const fields = line.split(',');
                    const sentenceType = fields[0];
                    
                    switch(sentenceType) {
                        case '$GNGGA':
                        case '$GPGGA':
                            this.parseGGA(fields);
                            break;
                        case '$GNRMC':
                        case '$GPRMC':
                            this.parseRMC(fields);
                            break;
                        case '$GNGSA':
                        case '$GPGSA':
                            this.parseGSA(fields);
                            break;
                        case '$GPTXT':
                            if (line.includes('PPS')) {
                                this.detectPPS();
                            }
                            break;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ NMEA:', error);
                    this.errorCount++;
                }
            }

            parseGGA(fields) {
                // $GNGGA,time,lat,lat_dir,lon,lon_dir,quality,num_sats,hdop,alt,alt_units,...*checksum
                if (fields[6] && fields[6] !== '0') {
                    const lat = this.convertToDecimal(fields[2], fields[3]);
                    const lon = this.convertToDecimal(fields[4], fields[5]);
                    
                    if (lat && lon) {
                        this.updatePosition(lat, lon);
                    }
                    
                    if (fields[9]) {
                        this.altitude = parseFloat(fields[9]);
                        document.getElementById('altitude').textContent = 
                            `${this.altitude.toFixed(1)} –º`;
                    }
                }
                
                // –í—Ä–µ–º—è GPS
                if (fields[1]) {
                    const timeStr = fields[1];
                    if (timeStr.length >= 6) {
                        const formattedTime = `${timeStr.substr(0,2)}:${timeStr.substr(2,2)}:${timeStr.substr(4,2)}`;
                        this.timestamp = formattedTime;
                        document.getElementById('gpsTime').textContent = formattedTime;
                    }
                }
                
                // –ö–∞—á–µ—Å—Ç–≤–æ —Ñ–∏–∫—Å–∞—Ü–∏–∏
                if (fields[6]) {
                    this.updateFixQuality(parseInt(fields[6]));
                }
                
                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø—É—Ç–Ω–∏–∫–æ–≤
                if (fields[7]) {
                    this.num_satellites = parseInt(fields[7]);
                    document.getElementById('satellitesCount').textContent = this.num_satellites;
                    const percent = Math.min((this.num_satellites / 20) * 100, 100);
                    document.getElementById('satelliteBar').style.width = `${percent}%`;
                }
                
                // HDOP
                if (fields[8]) {
                    this.hdop = parseFloat(fields[8]);
                    document.getElementById('hdop').textContent = this.hdop.toFixed(1);
                    this.updateHDOPQuality(this.hdop);
                }
            }

            parseRMC(fields) {
                // $GNRMC,time,status,lat,lat_dir,lon,lon_dir,speed,course,date,...*checksum
                if (fields[2] === 'A') {
                    const lat = this.convertToDecimal(fields[3], fields[4]);
                    const lon = this.convertToDecimal(fields[5], fields[6]);
                    
                    if (lat && lon) {
                        this.updatePosition(lat, lon);
                    }
                    
                    // –°–∫–æ—Ä–æ—Å—Ç—å
                    if (fields[7]) {
                        const speedKnots = parseFloat(fields[7]);
                        this.speed = speedKnots * 1.852;
                        document.getElementById('speed').textContent = 
                            `${this.speed.toFixed(1)} –∫–º/—á`;
                    }
                    
                    // –ö—É—Ä—Å
                    if (fields[8]) {
                        this.course = parseFloat(fields[8]);
                        document.getElementById('course').textContent = 
                            `${this.course.toFixed(0)}¬∞`;
                    }
                }
            }

            parseGSA(fields) {
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∂–∏–º–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
            }

            convertToDecimal(coord, direction) {
                if (!coord || !direction) return null;
                
                try {
                    // –§–æ—Ä–º–∞—Ç: DDMM.MMMMM
                    const degrees = parseFloat(coord.substring(0, 2));
                    const minutes = parseFloat(coord.substring(2));
                    
                    let decimal = degrees + minutes / 60.0;
                    
                    if (direction === 'S' || direction === 'W') {
                        decimal = -decimal;
                    }
                    
                    return decimal;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', error);
                    return null;
                }
            }

            detectPPS() {
                this.ppsCount++;
                document.getElementById('ppsStatus').textContent = '‚úÖ PPS –ê–ö–¢–ò–í–ï–ù';
                document.getElementById('ppsStatus').classList.add('pulse');
                document.getElementById('ppsCount').textContent = this.ppsCount;
                
                setTimeout(() => {
                    document.getElementById('ppsStatus').textContent = '‚ö™ –û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById('ppsStatus').classList.remove('pulse');
                }, 2000);
            }

            updatePosition(lat, lon) {
                this.latitude = lat;
                this.longitude = lon;
                
                const coordsText = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                document.getElementById('coordinates').textContent = coordsText;
                
                const latLng = [lat, lon];
                
                if (this.marker) {
                    this.marker.setLatLng(latLng);
                } else {
                    this.marker = L.marker(latLng)
                        .addTo(this.map)
                        .bindPopup('–¢–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ GPS')
                        .openPopup();
                    
                    this.map.setView(latLng, 15);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä—É–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏ –µ—Å–ª–∏ –µ—Å—Ç—å HDOP
                if (this.hdop && this.hdop > 0) {
                    const accuracyRadius = this.hdop * 5; // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
                    
                    // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫—Ä—É–≥
                    if (this.accuracyCircle) {
                        this.map.removeLayer(this.accuracyCircle);
                    }
                    
                    this.accuracyCircle = L.circle(latLng, {
                        radius: accuracyRadius,
                        color: '#3498db',
                        fillColor: '#2980b9',
                        fillOpacity: 0.1,
                        weight: 1
                    }).addTo(this.map);
                }
            }

            updateFixQuality(quality) {
                const qualities = {
                    0: ['–ù–µ—Ç —Ñ–∏–∫—Å–∞—Ü–∏–∏', 'quality-none'],
                    1: ['GPS —Ñ–∏–∫—Å–∞—Ü–∏—è', 'quality-excellent'],
                    2: ['DGPS —Ñ–∏–∫—Å–∞—Ü–∏—è', 'quality-good'],
                    3: ['PPS —Ñ–∏–∫—Å–∞—Ü–∏—è', 'quality-excellent'],
                    4: ['RTK', 'quality-excellent'],
                    5: ['Float RTK', 'quality-good']
                };
                
                const [text, className] = qualities[quality] || ['–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', 'quality-none'];
                const element = document.getElementById('fixStatus');
                element.textContent = text;
                element.className = `status-value ${className}`;
            }

            updateHDOPQuality(hdop) {
                const element = document.getElementById('hdop');
                if (hdop < 1) element.className = 'status-value quality-excellent';
                else if (hdop < 2) element.className = 'status-value quality-good';
                else if (hdop < 5) element.className = 'status-value quality-poor';
                else element.className = 'status-value quality-none';
            }

            updateConnectionStatus(status, message) {
                const indicator = document.getElementById('connectionIndicator');
                const statusElement = document.getElementById('connectionStatus');
                
                statusElement.textContent = message;
                
                indicator.className = 'signal-indicator';
                if (status === 'connected') {
                    indicator.classList.add('signal-strong');
                    this.isConnected = true;
                } else if (status === 'error') {
                    indicator.classList.add('signal-weak');
                    this.isConnected = false;
                }
            }

            displayNMEALine(line) {
                const nmeaDiv = document.getElementById('nmeaData');
                const timestamp = new Date().toLocaleTimeString();
                nmeaDiv.innerHTML += `[${timestamp}] ${line}\n`;
                nmeaDiv.scrollTop = nmeaDiv.scrollHeight;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫
                const lines = nmeaDiv.innerHTML.split('\n');
                if (lines.length > 50) {
                    nmeaDiv.innerHTML = lines.slice(-50).join('\n');
                }
            }

            updateDisplay() {
                document.getElementById('messageCount').textContent = this.messageCount;
                document.getElementById('errorCount').textContent = this.errorCount;
                document.getElementById('invalidCount').textContent = this.invalidCount;
                
                // –†–∞—Å—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É)
                const uptimeSeconds = (Date.now() - this.startTime) / 1000;
                const dataRate = uptimeSeconds > 0 ? (this.messageCount / uptimeSeconds).toFixed(1) : '0';
                document.getElementById('dataRate').textContent = `${dataRate}/—Å`;
            }

            updateUptime() {
                const uptimeSeconds = Math.floor((Date.now() - this.startTime) / 1000);
                const hours = Math.floor(uptimeSeconds / 3600);
                const minutes = Math.floor((uptimeSeconds % 3600) / 60);
                const seconds = uptimeSeconds % 60;
                
                document.getElementById('uptime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        let gpsTracker;
        document.addEventListener('DOMContentLoaded', () => {
            gpsTracker = new GPSTracker();
        });
    </script>
</body>
</html>

